<div *ngIf="room && room.status === 'WAITING'" class="waiting-for-start">
  <div class="info-box">
    <h3>Game Setup</h3>
    <p>Waiting for host to start the game...</p>
  </div>

  <div *ngIf="isHost" class="host-controls">
    <button class="start-game-btn" (click)="startGame()">
      <i class="fas fa-play"></i> Start Game
    </button>
  </div>
</div>

<div class="question" *ngIf="currentQuestion && currentQuestion.text">
  <h3>{{ currentQuestion.text }}</h3>
</div>

<div *ngIf="isAnswerer && gameStarted" class="answer-section">
  <div *ngIf="!answerSubmitted">
    <textarea
      [(ngModel)]="myAnswer"
      placeholder="Write your answer here..."
      [disabled]="!gameStarted || gameFinished"
    ></textarea>
    <button
      class="submit-answer"
      (click)="submitAnswer()"
      [disabled]="!myAnswer.trim() || !gameStarted || gameFinished"
    >
      Submit Answer
    </button>
  </div>

  <div *ngIf="answerSubmitted" class="waiting-for-suggestions">
    <p>Waiting for suggestions...</p>
  </div>
</div>

<div
  *ngIf="!isAnswerer && gameStarted && !gameFinished"
  class="correction-section"
>
  <div
    *ngIf="correctionSubmitted && waitingForCorrections"
    class="correction-submitted"
  >
    <p>Waiting for other suggestions...</p>
  </div>

  <div
    *ngIf="!correctionSubmitted && waitingForCorrections"
    class="correction-input"
  >
    <textarea
      [(ngModel)]="correction"
      placeholder="Suggest an improvement..."
      [disabled]="gameFinished"
    ></textarea>
    <button
      class="submit-correction"
      (click)="submitCorrection()"
      [disabled]="!correction.trim() || gameFinished"
    >
      Submit Correction
    </button>
  </div>

  <div
    *ngIf="correctionSubmitted && waitingForCorrections"
    class="correction-submitted"
  >
    <p>Correction submitted!</p>
  </div>
</div>

<div *ngIf="gameFinished && !showReport && room" class="game-finished-overlay">
  <div class="finished-content">
    <h2>üéâ Game Finished!</h2>
    <p>The session has ended. Thank you for playing!</p>

    <div class="finished-buttons">
      <button class="btn-home" (click)="goToHome()">
        <i class="fas fa-home"></i> Return to Home
      </button>

      <button class="btn-report" (click)="viewReport()">
        <i class="fas fa-file-alt"></i> View Results
      </button>
    </div>
  </div>
</div>

<div *ngIf="showReport && report" class="report-overlay">
  <div class="report-content">
    <h2>Game Report</h2>
    <p><strong>Room:</strong> {{ report.roomId }}</p>
    <p><strong>Pack:</strong> {{ report.packName }}</p>

    <div class="questions" *ngFor="let q of report.questions; let i = index">
      <h3>Question {{ i + 1 }}: {{ q.questionText }}</h3>

      <div *ngIf="q.answer" class="answer-section">
        <h4>Answer:</h4>
        <p>{{ q.answer.text }}</p>
        <small>by Player {{ q.answer.playerName || "Unknown" }}</small>
      </div>

      <div class="corrections-section" *ngIf="q.corrections?.length">
        <h4>Corrections ({{ q.corrections.length }}):</h4>
        <div *ngFor="let c of q.corrections" class="correction-item">
          <p>{{ c.text }}</p>
          <small>by Player {{ c.playerName || "Unknown" }}</small>
        </div>
      </div>

      <div *ngIf="!q.answer && (!q.corrections || q.corrections.length === 0)">
        <p><em>No answers or corrections.</em></p>
      </div>
    </div>

    <div class="report-buttons">
      <button (click)="showReport = false" class="btn-back">
        ‚Üê Back to Summary
      </button>
      <button (click)="goToHome()" class="btn-home-small">
        Return to Home
      </button>
    </div>
  </div>
</div>
